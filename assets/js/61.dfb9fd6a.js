(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{433:function(s,n,t){"use strict";t.r(n);var a=t(2),e=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"vuepress-docker-jenkins-自动化博客部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vuepress-docker-jenkins-自动化博客部署"}},[s._v("#")]),s._v(" vuepress + docker + jenkins 自动化博客部署")]),s._v(" "),n("blockquote",[n("p",[s._v("建立博客，构建自己的知识体系，这件事情，最好的开始时间是两年前，其次是现在。谨以此与诸位共勉。")])]),s._v(" "),n("h2",{attrs:{id:"_1-博客项目创建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-博客项目创建"}},[s._v("#")]),s._v(" 1. 博客项目创建")]),s._v(" "),n("blockquote",[n("p",[s._v("也曾尝试过其他的博客搭建方式比如halo等项目，但是后面还是决定选择vuepress，构建个人的知识体系，更注重的是进行知识输出和整理，\nvuepress通过提供一个将.md文件编译成静态HTML的编译方式，使用我们熟悉的项目形式进行知识管理和输出，可以让我们更加专注于进行知识体系构建\n更不是打造一个只是好看但是意义不大还很难进行知识整理输出的博客。以上仅代表个人意见，个人认为博客的主要意义在于知识体系构建和分享交流。")])]),s._v(" "),n("h3",{attrs:{id:"_1-vuepress-项目构建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-vuepress-项目构建"}},[s._v("#")]),s._v(" 1. vuepress 项目构建")]),s._v(" "),n("blockquote",[n("p",[s._v("构建一个vuepress项目其实就相当于构建一个个人的博客项目。嫌弃博主写的不好可以直接转道vuepress文档：https://v2.vuepress.vuejs.org/zh/")])]),s._v(" "),n("ol",[n("li",[s._v("初始化项目比较简单，只需要根据vuepress文档"),n("a",{attrs:{href:"https://v2.vuepress.vuejs.org/zh/guide/getting-started.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("快速上手"),n("OutboundLink")],1),s._v("步骤直接走即可")]),s._v(" "),n("li",[s._v("初始化完成之后，可以选择一个自己喜欢的博客主题，网上有很多开源可用的vuepress文档主题，加载进来根据主题的配置自定义自己的文章即可，\n博主使用的是："),n("a",{attrs:{href:"https://github.com/xugaoyi/vuepress-theme-vdoing",target:"_blank",rel:"noopener noreferrer"}},[s._v("vuepress-theme-vdoing"),n("OutboundLink")],1),s._v("，根据"),n("a",{attrs:{href:"https://doc.xugaoyi.com",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),n("OutboundLink")],1),s._v("引入即可")])]),s._v(" "),n("h3",{attrs:{id:"_2-码云或者github创建项目-将项目上传"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-码云或者github创建项目-将项目上传"}},[s._v("#")]),s._v(" 2. 码云或者GitHub创建项目，将项目上传")]),s._v(" "),n("blockquote",[n("p",[s._v("在码云gitee亦或者GitHub创建项目，将vuepress构建的博客项目上传，推荐码云，因为GitHub国内用起来不太友好，主要还是网络问题，经常链接超时。\n如果已经在GitHub创建了项目不想改仓库的话，也可以选择码云gitee导入同步一个相同的项目。博主使用的是GitHub")])]),s._v(" "),n("h2",{attrs:{id:"_2-服务器自动化部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务器自动化部署"}},[s._v("#")]),s._v(" 2. 服务器自动化部署")]),s._v(" "),n("blockquote",[n("p",[s._v("完成这个功能其实并不困难，只需要在服务器安装docker、并加载Jenkins镜像，启动一个Jenkins容器，构建一个任务流即可。\n当然如果对外提供博客的访问，需要安装nginx，使用nginx代理编译号的博客静态资源")])]),s._v(" "),n("h3",{attrs:{id:"_1-安装docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装docker"}},[s._v("#")]),s._v(" 1. 安装docker")]),s._v(" "),n("div",{staticClass:"language-shell script line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载之前的残留")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum remove "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-client "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-client-latest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-common "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-latest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-latest-logrotate "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-logrotate "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                  docker-engine\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装依赖库")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum-config-manager "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --add-repo "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    https://download.docker.com/linux/centos/docker-ce.repo\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装DOCKER引擎")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce docker-ce-cli containerd.io\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动docker服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看版本号，到这一步就安装完成了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" -v\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开机自启docker服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("h3",{attrs:{id:"_2-安装jenkins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装jenkins"}},[s._v("#")]),s._v(" 2. 安装Jenkins")]),s._v(" "),n("div",{staticClass:"language-shell script line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取jenkins镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull jenkins/jenkins:lts\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建Jenkins容器数据路径")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /data/app/tools/jenkins/jenkins_home\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将jenkins_home目录权限赋予Jenkins容器内的用户")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" /data/app/tools/jenkins/jenkins_home\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动容器（路径/data/app/webapp/8100，是用来存放构建好之后的博客资源也就是html文件，也可以直接放在jenkins_home目录下）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name jenkins "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /data/app/tools/jenkins/jenkins_home:/var/jenkins_home "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /data/app/webapp/8100:/data/app/webapp/8100 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /var/run/docker.sock:/var/run/docker.sock "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9080")]),s._v(":8080 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(":50000 --restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure jenkins/jenkins:lts\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用root用户进入Jenkins 容器，生成ssh密钥，并添加到GitHub")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Your identification has been saved in /root/.ssh/id_rsa")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Your public key has been saved in /root/.ssh/id_rsa.pub")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it -uroot jenkins "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输入完一直回车就结束了")]),s._v("\nssh-keygen -t rsa -C "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v("  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看公钥和私钥（配置时需要用到）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /root/.ssh/id_rsa "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 私钥 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /root/.ssh/id_rsa.pub "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 公钥")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 尝试拉取GitHub项目，使用ssh拉取方式，将xxx替换成自己的项目地址（需要将ssh公钥，添加到GitHub账号的ssh设置里面）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone git@github.com:xxx/xxx.git\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("ol",[n("li",[s._v("初始化进入Jenkins，在容器日志里面找到登录密码，添加一个自己的用户")]),s._v(" "),n("li",[s._v("点击推荐安装即可，安装不成功，另外找方法，或者设置代理")]),s._v(" "),n("li",[s._v("插件管理里面需要完成git和nodejs的安装")])]),s._v(" "),n("h3",{attrs:{id:"_3-创建jenkins自动化构建任务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建jenkins自动化构建任务"}},[s._v("#")]),s._v(" 3. 创建Jenkins自动化构建任务")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("构建一个自由风格的项目")])]),s._v(" "),n("li",[n("p",[s._v("选择GitHub项目，填写项目地址（ssh）,添加ssh类型的验证账号，账号名root和私钥，私钥前面有说，其他的构建风格自选")])]),s._v(" "),n("li",[n("p",[s._v("只有两个重点，构建触发选择：GitHub hook trigger for GITScm polling，这一步是通过提交代码自动触发构建，\n还有构建环境选择：Provide Node & npm bin/ folder to PATH，提供nodejs环境。")])]),s._v(" "),n("li",[n("p",[s._v("GitHub hook需要在拉取的GitHub项目设置里面添加webhook指向：http://IP:端口/github-webhook/,IP端口换成自己的。\nJenkins的系统管理里面的系统配置可以测试GitHub服务器链接\n")]),n("p",{attrs:{align:"center"}},[n("img",{staticStyle:{cursor:"zoom-in"},attrs:{src:"/images/blog/01.png"}})]),n("p")]),s._v(" "),n("li",[n("p",[s._v("Nodejs 先在插件管理安装nodejs插件，然后在全局工具配置添加或者安装指定版本的nodejs，如果自动安装不成功就使用手动安装")])]),s._v(" "),n("li",[n("p",[s._v("构建命令参考")])])]),s._v(" "),n("div",{staticClass:"language-shell script line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'项目路径'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LANG")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"en_US.UTF-8"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'准备更新博客环境...'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKSPACE")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重置还原代码")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clean -fxd\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载依赖")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" -v\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'开始打包...'")]),s._v("\nvuepress build docs\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将打包文件复制到指定位置")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -rf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKSPACE")]),s._v("/docs/.vuepress/dist /data/app/webapp/8100\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'看看这个工作目录...'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKSPACE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'更新完毕...'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);